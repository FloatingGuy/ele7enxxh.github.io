<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 使用afl-dyninst fuzz无源码的二进制程序 · Ele7enxxh's Blog</title><meta name="description" content="使用afl-dyninst fuzz无源码的二进制程序 - ele7enxxh"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.lug.ustc.edu.cn/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/5545520757" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/ele7enxxh" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">使用afl-dyninst fuzz无源码的二进制程序</h1><div class="post-info">Sep 14, 2016</div><div class="post-content"><p>通常来讲,afl-fuzz需要对待fuzz程序重编译,重而对其进行插桩,这就要求拥有待fuzz程序的完整源代码。而afl-dyninst提供了一种静态无源码插桩的手段使得可以对无源码二进制程序插桩。<a id="more"></a></p>
<p>本文的测试系统为:ubuntu14.04。</p>
<h2 id="下载-amp-amp-编译"><a href="#下载-amp-amp-编译" class="headerlink" title="下载&amp;&amp;编译"></a>下载&amp;&amp;编译</h2><p>首先需要安装以下软件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libelf-dev libelf1 libiberty-dev libboost-all-dev</span><br></pre></td></tr></table></figure></p>
<p>afl-dyninst是基于dyninst的,所以需要下载&amp;&amp;编译&amp;&amp;安装dyninst:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/dyninst/dyninst.git</span><br><span class="line">cd dyninst</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake -DBOOST_LIBRARYDIR=/usr/lib/x86_64-linux-gnu</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure></p>
<p>下载&amp;&amp;编译afl-dyninst<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/talos-vulndev/afl-dyninst.git</span><br><span class="line">cd afl-dyninst</span><br><span class="line">make</span><br><span class="line">sudo cp afl-dyninst /usr/bin/</span><br><span class="line">sudo cp libAflDyninst.so /usr/local/lib/</span><br><span class="line">echo &quot;/usr/local/lib&quot; &gt; /etc/ld.so.conf.d/dyninst.conf &amp;&amp; ldconfig</span><br><span class="line">echo &quot;export DYNINSTAPI_RT_LIB=/usr/local/lib/libdyninstAPI_RT.so&quot; &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Usage: ./afl-dyninst -i &lt;binary&gt; -o &lt;binary&gt; -l &lt;library&gt; -e &lt;address&gt; -s &lt;number&gt;</span><br><span class="line">             -i: Input binary </span><br><span class="line">             -o: Output binary</span><br><span class="line">             -l: Library to instrument (repeat for more than one)</span><br><span class="line">             -e: Entry point address to patch (required for stripped binaries)</span><br><span class="line">             -r: Runtime library to instrument (path to, repeat for more than one)</span><br><span class="line">             -s: Number of basic blocks to skip</span><br><span class="line">             -v: Verbose output</span><br><span class="line">example:</span><br><span class="line">afl-dyninst -i testbin -o testbin_ins</span><br><span class="line">to fuzz:</span><br><span class="line">export AFL_SKIP_BIN_CHECK=1</span><br><span class="line">afl-fuzz -i in -o out testbin_ins</span><br></pre></td></tr></table></figure>
<p>dyninst目前支持POWER/Linux, x86/Linux, x86_64/Linux,x86/Windows XP/2000/2003/Windows 7多个平台以及aarch64,不过可惜的是不支持arm/thumb。afl-dyninst于15年3月公布,不过到目前为止还未添加到afl-fuzz的发行版本中,推测其应该存在较多的bug。不过dyninst项目目前仍然活跃,相信以后会更加成熟。持续关注中!</p>
</div></article></div></section><footer><div class="paginator"><a href="/Bctf-2016-LostFlower-Writeup.html" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'ele7enxxh';
var disqus_identifier = 'Use-Afl-dyninst-To-Fuzz-Blackbox-Binaries.html';
var disqus_title = '使用afl-dyninst fuzz无源码的二进制程序';
var disqus_url = 'http://ele7enxxh.com/Use-Afl-dyninst-To-Fuzz-Blackbox-Binaries.html';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//ele7enxxh.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://ele7enxxh.com">ele7enxxh</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?e9925f9b47e12674b38b04ce3cde49e6";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script></body></html>